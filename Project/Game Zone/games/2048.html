<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2048 Game - Enhanced</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      background: #faf8ef;
      margin: 0;
      padding: 20px;
    }
    .main {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin: 20px;
    }
    #game {
      display: grid;
      grid-template-columns: repeat(4, 100px);
      grid-template-rows: repeat(4, 100px);
      gap: 10px;
      background: #bbada0;
      padding: 10px;
      border-radius: 10px;
    }
    .tile {
      width: 100px;
      height: 100px;
      background: #cdc1b4;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 28px;
      font-weight: bold;
      color: #776e65;
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    .score {
      margin: 10px;
      font-size: 20px;
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 36px;
      display: none;
      flex-direction: column;
    }
    .overlay button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 20px;
    }
    .instructions {
      max-width: 300px;
      margin-left: 40px;
      background: #fff8dc;
      padding: 20px;
      border-radius: 10px;
      font-size: 16px;
      line-height: 1.6;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .instructions h2 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <div class="main">
    <h1>2048 Game</h1>
    <div class="score">Score: <span id="score">0</span></div>
    <div id="game"></div>
    <div class="overlay" id="gameOver">
      <div id="gameOverMessage"></div>
      <button onclick="restartGame()">Restart</button>
    </div>
  </div>
  <div class="instructions">
    <h2>How to Play</h2>
    <ul>
      <li>Use your <strong>arrow keys</strong> to move the tiles.</li>
      <li>When two tiles with the same number touch, they <strong>merge into one</strong>.</li>
      <li>The goal is to reach the <strong>2048 tile</strong>.</li>
      <li>If the board fills up and no moves are left, the game is over.</li>
    </ul>
    <p>Good luck and enjoy!</p>
  </div>

  <script>
    const size = 4;
    const board = [];
    let score = 0;
    const game = document.getElementById('game');
    const scoreEl = document.getElementById('score');
    const overlay = document.getElementById('gameOver');
    const gameOverMessage = document.getElementById('gameOverMessage');

    function initBoard() {
      game.innerHTML = '';
      overlay.style.display = 'none';
      for (let i = 0; i < size; i++) {
        board[i] = [];
        for (let j = 0; j < size; j++) {
          board[i][j] = 0;
          const tile = document.createElement('div');
          tile.className = 'tile';
          tile.id = `tile-${i}-${j}`;
          game.appendChild(tile);
        }
      }
      score = 0;
      spawnTile();
      spawnTile();
      drawBoard();
    }

    function spawnTile() {
      let empty = [];
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (board[i][j] === 0) empty.push([i, j]);
        }
      }
      if (empty.length === 0) return;
      const [x, y] = empty[Math.floor(Math.random() * empty.length)];
      board[x][y] = Math.random() > 0.9 ? 4 : 2;
    }

    function drawBoard() {
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          const tile = document.getElementById(`tile-${i}-${j}`);
          tile.textContent = board[i][j] === 0 ? '' : board[i][j];
          tile.style.background = getTileColor(board[i][j]);
        }
      }
      scoreEl.textContent = score;
    }

    function getTileColor(val) {
      const colors = {
        0: '#cdc1b4', 2: '#eee4da', 4: '#ede0c8', 8: '#f2b179',
        16: '#f59563', 32: '#f67c5f', 64: '#f65e3b',
        128: '#edcf72', 256: '#edcc61', 512: '#edc850',
        1024: '#edc53f', 2048: '#edc22e'
      };
      return colors[val] || '#3c3a32';
    }

    function move(direction) {
      let moved = false;
      for (let i = 0; i < size; i++) {
        let row = board[i];
        if (direction === 'left' || direction === 'right') {
          row = direction === 'right' ? [...row].reverse() : row;
          let newRow = compress(row);
          if (direction === 'right') newRow.reverse();
          if (board[i].toString() !== newRow.toString()) moved = true;
          board[i] = newRow;
        } else {
          let col = board.map(r => r[i]);
          col = direction === 'down' ? [...col].reverse() : col;
          let newCol = compress(col);
          if (direction === 'down') newCol.reverse();
          if (board.map(r => r[i]).toString() !== newCol.toString()) moved = true;
          for (let j = 0; j < size; j++) board[j][i] = newCol[j];
        }
      }
      if (moved) {
        spawnTile();
        drawBoard();
        if (isGameOver()) showGameOver();
        if (checkWin()) showWin();
      }
    }

    function compress(row) {
      row = row.filter(n => n);
      for (let i = 0; i < row.length - 1; i++) {
        if (row[i] === row[i + 1]) {
          row[i] *= 2;
          score += row[i];
          row[i + 1] = 0;
        }
      }
      return [...row.filter(n => n), ...Array(size - row.filter(n => n).length).fill(0)];
    }

    function isGameOver() {
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (board[i][j] === 0) return false;
          if (i < size - 1 && board[i][j] === board[i + 1][j]) return false;
          if (j < size - 1 && board[i][j] === board[i][j + 1]) return false;
        }
      }
      return true;
    }

    function checkWin() {
      return board.flat().includes(2048);
    }

    function showGameOver() {
      gameOverMessage.textContent = 'Game Over!';
      overlay.style.display = 'flex';
    }

    function showWin() {
      gameOverMessage.textContent = 'ðŸŽ‰ You Win!';
      overlay.style.display = 'flex';
    }

    function restartGame() {
      initBoard();
    }

    window.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft') move('left');
      else if (e.key === 'ArrowRight') move('right');
      else if (e.key === 'ArrowUp') move('up');
      else if (e.key === 'ArrowDown') move('down');
    });

    initBoard();
  </script>
</body>
</html>
