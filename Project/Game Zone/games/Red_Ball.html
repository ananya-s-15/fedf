<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Red Ball Adventure</title>
  <style>
    body {
      margin: 0;
      background: #f0f0f0;
      font-family: sans-serif;
      text-align: center;
    }

    canvas {
      display: block;
      margin: 20px auto;
      background: linear-gradient(to bottom, #a2d5f2, #ffffff);
      border: 2px solid #333;
    }

    h1 {
      margin-top: 10px;
    }

    #info {
      font-size: 18px;
      margin-top: -10px;
    }

    #winMessage {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 36px;
      z-index: 10;
      flex-direction: column;
      display: none;
    }

    #winMessage h2 {
      font-size: 48px;
      margin: 0 0 20px 0;
      animation: pop 1s ease-in-out infinite alternate;
    }

    #winMessage button {
      padding: 10px 20px;
      font-size: 20px;
      cursor: pointer;
      background: gold;
      border: none;
      border-radius: 10px;
      box-shadow: 0 0 10px #fff;
    }

    @keyframes pop {
      from { transform: scale(1); }
      to { transform: scale(1.1); }
    }
  </style>
</head>
<body>

<h1>Red Ball Adventure</h1>
<div id="info">Level: 1 | Coins Collected: 0</div>
<canvas id="gameCanvas" width="800" height="400"></canvas>

<div id="winMessage">
  <h2>ðŸŽ‰ Congratulations! You Beat All Levels! ðŸŽ‰</h2>
  <button onclick="restartGame()">Play Again</button>
</div>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const info = document.getElementById('info');
  const winMessage = document.getElementById('winMessage');

  let keys = {};
  document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
  document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

  const gravity = 0.6;
  const friction = 0.8;

  let levelIndex = 0;
  let player, cameraX;
  let totalCoins = 0;

  const levels = [
    {
      platforms: [
        { x: 0, y: 360, w: 1600, h: 40 },
        { x: 300, y: 300, w: 120, h: 10 },
        { x: 500, y: 240, w: 100, h: 10 },
        { x: 700, y: 180, w: 100, h: 10 },
      ],
      coins: [
        { x: 310, y: 270 },
        { x: 510, y: 210 },
      ],
      goal: { x: 720, y: 140, w: 30, h: 50 }
    },
    {
      platforms: [
        { x: 0, y: 360, w: 300, h: 40 },
        { x: 400, y: 280, w: 100, h: 10 },
        { x: 550, y: 230, w: 100, h: 10 },
        { x: 700, y: 160, w: 100, h: 10 },
      ],
      coins: [
        { x: 410, y: 250 },
        { x: 710, y: 130 },
      ],
      goal: { x: 750, y: 110, w: 30, h: 50 }
    },
    {
      platforms: [
        { x: 0, y: 360, w: 1600, h: 40 },
        { x: 200, y: 310, w: 120, h: 10 },
        { x: 200, y: 230, w: 120, h: 10 },
        { x: 400, y: 310, w: 120, h: 10 },
        { x: 400, y: 230, w: 120, h: 10 },
      ],
      coins: [
        { x: 210, y: 280 },
        { x: 410, y: 280 },
        { x: 210, y: 200 },
        { x: 410, y: 200 },
      ],
      goal: { x: 550, y: 180, w: 30, h: 50 }
    },
    {
      platforms: [
        { x: 0, y: 360, w: 200, h: 40 },
        { x: 220, y: 310, w: 80, h: 10 },
        { x: 300, y: 260, w: 80, h: 10 },
        { x: 380, y: 210, w: 80, h: 10 },
        { x: 460, y: 160, w: 80, h: 10 },
      ],
      coins: [
        { x: 230, y: 280 },
        { x: 310, y: 230 },
        { x: 390, y: 180 },
      ],
      goal: { x: 470, y: 110, w: 30, h: 50 }
    },
    {
      platforms: [
        { x: 0, y: 360, w: 200, h: 40 },
        { x: 300, y: 330, w: 100, h: 10 },
        { x: 500, y: 300, w: 100, h: 10 },
        { x: 700, y: 270, w: 100, h: 10 },
        { x: 900, y: 240, w: 100, h: 10 },
        { x: 1100, y: 210, w: 100, h: 10 },
      ],
      coins: [
        { x: 310, y: 300 },
        { x: 510, y: 270 },
        { x: 710, y: 240 },
        { x: 910, y: 210 },
      ],
      goal: { x: 1120, y: 160, w: 30, h: 50 }
    }
  ];

  function startLevel(index) {
    const startX = 50;
    player = { x: startX, y: 0, dx: 0, dy: 0, w: 20, h: 20, grounded: false };
    levelIndex = index;
    cameraX = 0;
    updateInfo();
    winMessage.style.display = "none";
  }

  function updateInfo() {
    info.textContent = `Level: ${levelIndex + 1} | Coins Collected: ${totalCoins}`;
  }

  function update() {
    if (keys['arrowleft'] || keys['a']) player.dx = -4;
    if (keys['arrowright'] || keys['d']) player.dx = 4;
    if ((keys[' '] || keys['space']) && player.grounded) {
      player.dy = -12;
      player.grounded = false;
    }

    player.dy += gravity;
    player.x += player.dx;
    player.y += player.dy;
    player.dx *= friction;

    const level = levels[levelIndex];
    player.grounded = false;

    for (let platform of level.platforms) {
      if (
        player.x < platform.x + platform.w &&
        player.x + player.w > platform.x &&
        player.y < platform.y + platform.h &&
        player.y + player.h > platform.y
      ) {
        if (player.dy > 0) {
          player.y = platform.y - player.h;
          player.dy = 0;
          player.grounded = true;
        } else if (player.dy < 0) {
          player.y = platform.y + platform.h;
          player.dy = 0;
        }
      }
    }

    level.coins = level.coins.filter(c => {
      const hit =
        player.x < c.x + 10 &&
        player.x + player.w > c.x &&
        player.y < c.y + 10 &&
        player.y + player.h > c.y;
      if (hit) totalCoins++;
      return !hit;
    });

    const goal = level.goal;
    if (
      player.x < goal.x + goal.w &&
      player.x + player.w > goal.x &&
      player.y < goal.y + goal.h &&
      player.y + player.h > goal.y
    ) {
      if (levelIndex < levels.length - 1) {
        startLevel(levelIndex + 1);
      } else {
        winMessage.style.display = "flex";
      }
    }

    if (player.y > canvas.height + 200) {
      alert("ðŸ˜µ You fell! Restarting from Level 1.");
      totalCoins = 0;
      startLevel(0);
    }

    cameraX = Math.max(0, player.x - canvas.width / 2);
    updateInfo();
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const level = levels[levelIndex];

    for (let platform of level.platforms) {
      ctx.fillStyle = "#444";
      ctx.fillRect(platform.x - cameraX, platform.y, platform.w, platform.h);
    }

    for (let coin of level.coins) {
      ctx.fillStyle = "gold";
      ctx.beginPath();
      ctx.arc(coin.x - cameraX + 5, coin.y + 5, 5, 0, Math.PI * 2);
      ctx.fill();
    }

    const goal = level.goal;
    ctx.fillStyle = "green";
    ctx.fillRect(goal.x - cameraX, goal.y, goal.w, goal.h);

    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.arc(player.x - cameraX + player.w / 2, player.y + player.h / 2, player.w / 2, 0, Math.PI * 2);
    ctx.fill();
  }

  function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }

  function restartGame() {
    totalCoins = 0;
    startLevel(0);
  }

  startLevel(0);
  gameLoop();
</script>

</body>
</html>
